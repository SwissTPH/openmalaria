clone_depth: 30

environment:
  VisualStudioVersion: 14.0

os: Visual Studio 2015

# Run init scripts
# init:
# Clone repository into clone folder

# Checkout build commit
configuration: Release

# cd to clone folder

# Restore build cache
# cache:

# Run install scripts
install:
  - C:\cygwin64\bin\bash -lc "echo $HOME"
  - C:\cygwin64\bin\bash -lc "apt-get install zlib-devel make python2 cmake libboost-devel libgsl-devel xsd libxerces-c-devel"

build_script:
  - C:\cygwin64\bin\bash -lc "./build.sh"

# Test
# Run before_test scripts
# before_test:

# Discover and run tests (or test_script)
test_script:
  - C:\cygwin64\bin\bash -lc "pushd openmalaria"
  - C:\cygwin64\bin\bash -lc "pushd build"
  - C:\cygwin64\bin\bash -lc "ctest"
  - C:\cygwin64\bin\bash -lc "popd && popd"

# Run after_test scripts
# after_test:

# Package artifacts
artifacts:
  - path: openMalaria-windows.zip

# Deployment
deploy:
  provider: GitHub
  description: "OpenMalaria build for Windows"
  auth_token:
    secure: V6F6FNTQDN/Wg/8M9QNr79JSlO83uBAS6xnzW1RGjhz3KVUOsZToBPjgaoU6cOeE
  artifact: openMalaria-windows.zip
  draft: false
  prerelease: false
  on:
    branch: master
    appveyor_repo_tag: true
