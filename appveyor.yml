os: Visual Studio 2015

configuration: Release

# Run install scripts
install:
  - C:\cygwin64\bin\bash -lc "echo $HOME"
  - C:\cygwin64\bin\bash -lc "appveyor DownloadFile http://rawgit.com/transcode-open/apt-cyg/master/apt-cyg -FileName apt-cyg"
  - C:\cygwin64\bin\bash -lc "install apt-cyg /bin"
  - C:\cygwin64\bin\bash -lc "apt-cyg install wget"
  - C:\cygwin64\bin\bash -lc "apt-cyg install zlib-devel make python2 cmake libboost-devel libgsl-devel xsd libxerces-c-devel"

build_script:
  - C:\cygwin64\bin\bash -lc "cd /cygdrive/c/projects/openmalaria && ./build.sh --jobs=4 --artifact=openMalaria-windows"

# Discover and run tests (or test_script)
test_script:
  - C:\cygwin64\bin\bash -lc "cd /cygdrive/c/projects/openmalaria/build && ctest -j4"

# Package artifacts
artifacts:
  - path: C:\projects\openmalaria\openMalaria-windows.zip

# Deployment
deploy:
  provider: GitHub
  description: "OpenMalaria build for Windows"
  auth_token:
    secure: V6F6FNTQDN/Wg/8M9QNr79JSlO83uBAS6xnzW1RGjhz3KVUOsZToBPjgaoU6cOeE
  artifact: openMalaria-windows.zip
  draft: false
  prerelease: false
  on:
    branch: master
    appveyor_repo_tag: true
